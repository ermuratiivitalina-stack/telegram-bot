import os
import asyncio
from aiogram import Bot, Dispatcher, F
from aiogram.filters import CommandStart
from aiogram.types import (
    Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton, FSInputFile
)
from datetime import datetime, timedelta

BOT_TOKEN = os.getenv("BOT_TOKEN")
if not BOT_TOKEN:
    raise ValueError("BOT_TOKEN not set")

bot = Bot(BOT_TOKEN)
dp = Dispatcher()

# In-memory user data (for demo only, replace with DB or JSON in real case)
user_data = {}
CHANNEL_LINK = "https://t.me/your_private_channel"
PAYPAL_URL = "https://paypal.me/yourlink"
ADMIN_USERNAME = "Linavibeart"

# Language options
def language_keyboard():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="–†—É—Å—Å–∫–∏–π", callback_data="lang_ru")],
        [InlineKeyboardButton(text="Espa√±ol", callback_data="lang_es")]
    ])

# Start command
dp.message(CommandStart())
async def start(message: Message):
    await message.answer("Please choose your language / Por favor, elige el idioma", reply_markup=language_keyboard())

# Welcome keyboards
def main_menu(lang):
    text_pay = "üí≥ Pay" if lang == "en" else "–û–ø–ª–∞—Ç–∏—Ç—å"
    text_more = "‚ÑπÔ∏è Learn More" if lang == "en" else "–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ"
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text=text_pay, callback_data="pay")],
        [InlineKeyboardButton(text=text_more, callback_data="more")]
    ])

# After video keyboard
def after_video_keyboard(lang):
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üí≥ Pay", callback_data="pay")],
        [InlineKeyboardButton(text="‚ùì Have questions?", url=f"https://t.me/{ADMIN_USERNAME}")]
    ])

# Language selection
dp.callback_query(F.data.startswith("lang_"))
async def set_language(callback: CallbackQuery):
    lang = callback.data.split("_")[1]
    user_data[callback.from_user.id] = {
        "lang": lang,
        "subscribed": False,
        "subscription_expires": None
    }
    greeting = {
        "ru": "üëã –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –õ–∏–Ω—ã üòä\n–†–∞–¥, —á—Ç–æ —Ç—ã –∑–¥–µ—Å—å ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å —Å–æ–≤—Å–µ–º –Ω–µ–º043d043e–≥043e, —á—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –≤ –∑–∞–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ, –≥–¥0435 —É—á–∞—Ç—Å044f —Å043d0438–º0430—Ç044c –≤0438–¥0435043e –∏ —Ñ043e—Ç043e, –∫043e—Ç043e04400435 —Ü0435–ø043b044f—é0442 üé•‚ú®\n\n–í–Ω0443—Ç04400438 —Ç0435–±044f –∂–¥0451—Ç:\n‚úÖ –ü043e04340440043e0431043d044b0435 —Ä0430–∑0431043e0440044b –ø044004350434043c04350442043d044b0445 –≤043804340435043e\n‚úÖ –ö04400443043f043d044b0435 —Ä04350430043b044c043d044b0435 –ø0440043e0435043a0442044b\n‚úÖ –ü04400430043a04420438044704350441–∫04380435 —Å043e043204350442044b –ø043e —Å044a0451–º043a0435 –∏ —Å04320435—Ç0443\n‚úÖ –ú0438043d0438-—É—Ä043e043a0438 –∏ –ø043e043b04350437043d044b0435 ¬´–ø043b044e0448043a0438¬ª\n‚úÖ –†0430–∑0431043e0440044b –≤043804340435043e —Ä04300437043d043e0439 —Å043b043e0436043d043e044104420438 ‚Äî –æ0442 –ø0440043e04410442044b0445 –¥043e –ø0440043e043404320438043d04430442044b0445\n\nüí∞ –ü043e0434043f0438—Å–∫0430 ‚Äî –≤0441–µ–≥043e 15 –µ–≤0440043e –≤ –º04350441044f0446\n–ü043e0441043b0435 –æ043f043b04300442044b —Ç044b —Å0440043004370443 –ø043e043b0443—á0438—à044c –¥043e044104420443043f –≤ –∑0430–∫0440—ã—Ç044b0439 –∫0430043d0430043b —Å —É0440043e043a0430043c0438 –∏ –º0430—Ç0435044004380430043b0430043c0438 üîê\n\nüöÄ –ì043e0442043e0432 –Ω0430044704300442044c? –ö043d043e043f043a0438 –Ω043804360435 üëá",
        "es": "üëã ¬°Hola! Soy el asistente de Lina. Accede al canal privado con contenido exclusivo. ¬°Haz clic en los botones abajo!"
    }.get(lang, "üëã Welcome! Click the buttons below to continue.")
    await callback.message.answer(greeting, reply_markup=main_menu("en" if lang == "es" else "ru"))
    await callback.answer()

# Learn more (video)
dp.callback_query(F.data == "more")
async def send_video(callback: CallbackQuery):
    lang = user_data.get(callback.from_user.id, {}).get("lang", "en")
    video = FSInputFile("video.mp4")  # must be present in project directory
    caption = {
        "ru": "üé• –ü—Ä043e0441043c043e044204400438 –ø044004350432044c—é –Ω043004480435–≥043e –∫0430043d0430043b0430.",
        "es": "üé• Mira una vista previa del canal.",
    }.get(lang, "üé• Watch a preview of our channel.")
    await callback.message.answer_video(video=video, caption=caption, reply_markup=after_video_keyboard(lang))
    await callback.answer()

# Pay button
dp.callback_query(F.data == "pay")
async def pay_step(callback: CallbackQuery):
    await callback.message.answer(f"Please proceed to payment: {PAYPAL_URL}\nAfter payment, send a screenshot to @{ADMIN_USERNAME} to get access.")
    await callback.answer()

# Run bot
async
